<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Error Timeout Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Error Auto-Hide Test (5 seconds)</h1>
        
        <!-- 错误提示区域 -->
        <div id="error-message-container" class="alert alert-danger d-none align-items-center mb-3">
            <i class="bi bi-exclamation-triangle-fill me-2" style="font-size: 1.2rem;"></i>
            <div>
                <strong id="error-message-title">错误：</strong>
                <span id="error-message-text"></span>
            </div>
            <button type="button" class="btn-close ms-auto"
                onclick="hideError()"
                aria-label="Close"></button>
        </div>
        
        <button class="btn btn-danger" onclick="showTestError()">显示测试错误 (5秒后自动隐藏)</button>
        <button class="btn btn-success" onclick="hideError()">立即隐藏错误</button>
        
        <div class="mt-3">
            <p>倒计时: <span id="countdown">-</span> 秒</p>
        </div>
    </div>
    
    <script>
        let errorTimeout = null;
        let countdownInterval = null;
        
        function showError(message, title = '错误：', duration = 5000) {
            const container = document.getElementById('error-message-container');
            const titleEl = document.getElementById('error-message-title');
            const textEl = document.getElementById('error-message-text');

            if (container && textEl) {
                // 清除之前的定时器
                if (errorTimeout) {
                    clearTimeout(errorTimeout);
                }
                if (countdownInterval) {
                    clearInterval(countdownInterval);
                }

                titleEl.textContent = title;
                textEl.textContent = message;
                container.classList.remove('d-none');
                container.classList.add('d-flex');

                // 自动滚动到错误区域
                container.scrollIntoView({ behavior: 'smooth', block: 'center' });

                // 倒计时显示
                let remainingTime = duration / 1000;
                document.getElementById('countdown').textContent = remainingTime;
                
                countdownInterval = setInterval(() => {
                    remainingTime--;
                    document.getElementById('countdown').textContent = remainingTime;
                    if (remainingTime <= 0) {
                        clearInterval(countdownInterval);
                        document.getElementById('countdown').textContent = '-';
                    }
                }, 1000);

                // 自动隐藏
                errorTimeout = setTimeout(() => {
                    hideError();
                }, duration);
            } else {
                // 后备方案
                alert(`${title}${message}`);
            }
        }

        function hideError() {
            const container = document.getElementById('error-message-container');
            if (container) {
                container.classList.remove('d-flex');
                container.classList.add('d-none');
            }
            
            // 清除倒计时
            if (countdownInterval) {
                clearInterval(countdownInterval);
                document.getElementById('countdown').textContent = '-';
            }
            
            // 清除自动隐藏定时器
            if (errorTimeout) {
                clearTimeout(errorTimeout);
            }
        }
        
        function showTestError() {
            showError('这是一个测试错误消息，将在5秒后自动隐藏。你也可以点击右侧的X按钮立即关闭。');
        }
    </script>
</body>
</html>